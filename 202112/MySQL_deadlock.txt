死锁产生的原因：

产生回路：两个或两个以上的事务在执行过程中，分别持有一把锁，然后再加一把锁（AB-BA）产生死锁。
加锁顺序不一致：两个或两个以上的事务并发执行（同一时刻），因争夺资源而造成的一种互相等待，产生死锁。


下面来说明下InnoDB中如何减少死锁：

1. 自动死锁检测，优先回滚小事务；
2. 超时设置（参数innodb_lock_wait_timeout）;
3. 尽快提交事务，小事务不容易发生死锁；
4. 加for update，lock in share mode读锁时，最好降低事务隔离级别，例如使用RC（读已提交），降低死锁发生概率
5. 事务中涉及多个表，或多行时，每个事务操作顺序要保持一致，最好用存储过程/函数固化；
6. 通过索引等方式优化SQL效率，降低死锁发生概率（减少扫描/锁范围，降低概率；）
7. 在同一个事务中,尽可能做到一次锁定所需要的所有资源,减少死锁概率



给数据库行加锁
事务A操作 select * from table where id =1 for update